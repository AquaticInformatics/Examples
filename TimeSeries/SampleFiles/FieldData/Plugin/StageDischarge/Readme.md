# Sample Stage/Discharge field data file

AQUARIUS Time-Series can import field data from Stage/Discharge CSV files.

One CSV file can contain multiple stage/discharge measurements from multiple locations.
The CSV format supports stage/discharge pairs, with optional measurement IDs, and optional channel measurements.

# UPDATE: Use the Tabular CV plugin to parse these CSV files
The [StageDischargeReadings plugin](https://github.com/AquaticInformatics/stage-discharge-readings-field-data-plugin#stage-discharge-readings-field-data-plugin) is now obsolete, having been replaced by the [Tabular CSV plugin](https://github.com/AquaticInformatics/tabular-field-data-plugin#tabular-csv-field-data-plugin) in AQTS 2020.1.

You can use [this example configuration](https://aquaticinformatics.github.io/tabular-field-data-plugin/test-drive/?example=stagedischargereadingsformat) to parse the old StageDischargeReadings CSV format using the Tabular CSV plugin.

## AQUARIUS location identifiers

The `LocationIdentifier` field should contain the AQUARIUS location identifier in order to support automatic upload from Springboard.

## Sample file
Click [here](./StageDischargeSample.csv) to view/download a sample file.

## CSV file format

The supported CSV file has the following text rules:
- UTF-8 encoding is assumed. The UTF-8 byte-order-mark of (`0xEF, 0xBB, 0xBF`) at the start of the file is completely optional.
- Lines starting with a `#` as the first non-whitespace character are ignored as comment-lines.
- Completely blank lines are ignored.
- The header line (line 5 in the [example file](#example-file) below) can be repeated any number of times, and will always be ignored. The field names in the header line must match the English field names listed in the table below.
- Leading/trailing whitespace is allowed between fields.
- Double-quotes are only required if a field value contains a comma, or if the value must have leading/trailing whitespace.
- Multi-line text values are not supported. (ie. the **Comment** field must be a single line)

These rules help make the CSV file easy to edit in text editor, allowing you to visually align columns with extra spaces/tabs as needed.
But CSV files generated by your integration can completely omit any whitespace.

### Header lines

A header line does not need to appear at all in the CSV file.
But if it does exist, it must exactly match line 5 in the [example file](#example-file) below.
The header line must be the 18 field names, listed in the order below, separated by commas. Whitespace between column names is ignored.

### CSV Fields

There are 18 fields in each row.

|FieldName|Datatype|Required?|Description|
|---|---|---|---|
| **LocationIdentifier** | string | Y | The AQTS location identifier for the measurement.|
| **MeasurementId** | string | N | An optional measurement ID. Measurement IDs must be unique per location.|
| **MeasurementStartDateTime** | DateTimeOffset | Y | The start time of the measurement. See the [Timestamps](#timestamps) section below for format details. |
| **MeasurementEndDateTime** | DateTimeOffset | Y | The end time of the measurement, which cannot be earlier than the start time.|
| **StageAtStart** | double | Y | The stage value at the start of the measurement. |
| **StageAtEnd** | double | Y | The stage value at the end of the measurement. |
| **StageUnits** | string | Y | The units of the stage measurement. |
| **Discharge** | double | Y | The measured discharge flow. |
| **DischargeUnits** | string | Y | The units of the discharge measurement. |
| **ChannelName** | string | Y | The name of the channel in which the measurement was taken. |
| **ChannelWidth** | double | N | The width of the channel, measured in the same units as the stage values. If omitted, a value of zero will be used. |
| **WidthUnits** | string | Y | The units of the channel width measurement. |
| **ChannelArea** | double | N | The area of the channel. If omitted, a value of zero will be used. |
| **AreaUnits** | string | Y | The units of the channel area measurement. |
| **ChannelVelocity** | double | N | The average velocity of water in the channel. If omitted, a value of zero will be used. |
| **VelocityUnits** | string | Y | The units of the channel velocity measurement. |
| **Party** | string | N | A brief description of the who performed the measurement. |
| **Comments** | string | N | Any other comments you wish to add to the measurements. |

### Timestamps

Timestamps are specified in ISO 8601 format. Specifically the `"O"` (roundtrip) format for .NET DateTimeOffset values is used.

`yyyy-MM-ddTHH:mm:ss.fffffffzzz`

- The `T` character must separate the date and time portions.
- All seven fractional seconds digits are optional. This 100 nanosecond precision is the full resolution supported by AQUARIUS Time-Series.
- The time-zone (`zzz`) portion can either be an explicit offset in hours/minutes (`+04:00` or `-00:30`) or it can be the UTC indicator of the letter `Z`.
- These constraints ensure that the timestamps contain no ambiguity.

See https://docs.microsoft.com/en-us/dotnet/standard/base-types/standard-date-and-time-format-strings#Roundtrip for more details.

### Example file

This example file contains 4 measurements at two different locations.
- Two of the measurements occur on different days in April 2016 at `LocationA`, and will create two separate field visits in AQTS.
- Two of the measurements occur on the same day in May 2017 at `LocationB`, and will create a single visit containing both measurements.
- The order of measurement rows in the CSV file does not matter. The parser will sort all the rows by location and time before creating any field visit records.

```
# A comment line
#
# AQUARIUS Stage-Discharge CSV v1.0
#
LocationIdentifier, MeasurementId, MeasurementStartDateTime,          MeasurementEndDateTime,            StageAtStart, StageAtEnd, StageUnits, Discharge, DischargeUnits, ChannelName, ChannelWidth, WidthUnits, ChannelArea, AreaUnits, ChannelVelocity, VelocityUnits, Party, Comments
LocationA         , 46791        , 2016-04-01T00:00:00.0000000Z,      2016-04-01T02:00:00.0000000Z,      12.0,         12.5,       ft,         32.3,      ft^3/s,         Main,        ,             ft,         ,            ft^2,      ,                ft/s,          ,
                                                                                                    
LocationB         ,              , 2017-05-01T03:00:00.0000000+04:00, 2017-05-01T04:00:00.0000000+04:00, 8.7,          8.6,        ft,         13.5,      ft^3/s,         Main,        ,             ft,         ,            ft^2,      ,                ft/s,          ,      "Bubbler hose was disturbed, so we remeasured"
LocationB         , 852345       , 2017-05-01T05:00:00.0000000+04:00, 2017-05-01T06:00:00.0000000+04:00, 9.4,          9.4,        ft,         13.6,      ft^3/s,         Main,        ,             ft,         ,            ft^2,      ,                ft/s,          ,
                                                                                                    
LocationA         , 46792        , 2016-04-02T03:00:00.0000000Z,      2016-04-02T04:00:00.0000000Z,      11.85,        12.7,       ft,        132.3,      ft^3/s,         Main,        23.4,         ft,         125.63,      ft^2,       85.2,           ft/s,          Doug , My oh my what a comment
```

The end result of importing this CSV file will be:

```
LocationA
  Visit on April 1 2016
    Meas ID 46971  32.30 ft^3/s at 12.125 ft
  Visit on April 2 2016
    Meas ID 46972  132.3 ft^3/s at 12.275 ft
LocationB
  Visit on May 1 2017
                   13.50 ft^3/s at 8.650 ft
    Meas ID 852345 13.60 ft^3/s at 9.400 ft
```

The measurement IDs will be visible in the Rating Development Toolbox of AQUARIUS Time-Series.


The example file above contains a fair bit of whitespace and comments to make the data more easy to ready in a text editor.
But all of that whitespace and comments is not needed.

The following CSV text is identical in content to the above file, but with every optional bit of text removed:
```
LocationA,46791,2016-04-01T00:00:00.0000000Z,2016-04-01T02:00:00.0000000Z,12.0,12.5,ft,32.3,ft^3/s,Main,,ft,,ft^2,,ft/s,,
LocationB,,2017-05-01T03:00:00.0000000+04:00,2017-05-01T04:00:00.0000000+04:00,8.7,8.6,ft,13.5,ft^3/s,Main,,ft,,ft^2,,ft/s,,"Bubbler hose was disturbed, so we remeasured"
LocationB,852345,2017-05-01T05:00:00.0000000+04:00,2017-05-01T06:00:00.0000000+04:00,9.4,9.4,ft,13.6,ft^3/s,Main,,ft,,ft^2,,ft/s,,
LocationA,46792,2016-04-02T03:00:00.0000000Z,2016-04-02T04:00:00.0000000Z,11.85,12.7,ft,132.3,ft^3/s,Main,23.4,ft,125.63,ft^2,85.2,ft/s,Doug,My oh my what a comment
```
